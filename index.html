<!doctype html>
<html lang="en">
   <head>
      <meta charset="UTF-8">
      <title>Gloomy Pengiun's Travel Data</title> 
<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-EVSTQN3/azprG1Anm3QDgpJLIm9Nao0Yz1ztcQTwFspd3yD65VohhpuuCOmLASjC" crossorigin="anonymous">
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/js/bootstrap.bundle.min.js" integrity="sha384-MrcW6ZMFYlzcLA8Nl+NtUVF0sA7MsXsP1UyJoMp4YLEuNSfAP+JcXn/tWtIaxVXM" crossorigin="anonymous"></script>

      <link rel="stylesheet" href="travel-data.css">

      <link rel="apple-touch-icon" sizes="180x180" href="/favicon/apple-touch-icon.png">
      <link rel="icon" type="image/png" sizes="32x32" href="/favicon/favicon-32x32.png">
      <link rel="icon" type="image/png" sizes="16x16" href="/favicon/favicon-16x16.png">
      <link rel="manifest" href="/site.webmanifest">
   </head>
   <body style="background-image:
    linear-gradient(to left, rgba(0, 0, 0, 0.52), rgba(255, 255, 255, 0.73)),
    url('forest.jpg');
    background-position: center top; background-size: 100% auto; background-attachment: fixed;   background-repeat: no-repeat;">
 

<nav class="navbar navbar-expand-lg navbar-dark bg-dark">
  <div class="container-fluid">
    <a class="navbar-brand" href="#">Gloomy Penguin's Travel Data in Vanilla JS & Boostrap 5</a>
    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarSupportedContent" aria-controls="navbarSupportedContent" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>
    <div class="collapse navbar-collapse" id="navbarSupportedContent">
      <ul class="navbar-nav ms-auto mb-2 mb-lg-0">
        <li class="nav-item">
          <a id="navbarHomePage" class="nav-link active" aria-current="page" href="index.html?page=home">Home</a>
        </li> 

        <li class="nav-item dropdown">
          <a class="nav-link dropdown-toggle" href="#" id="navbarDropdown" role="button" data-bs-toggle="dropdown" aria-expanded="false">
            Destination Tags
          </a>
          <ul class="dropdown-menu" aria-labelledby="navbarDropdown" id="navbarDropdownList"> 
          </ul>
        </li>

        <li class="nav-item">
          <a id="navbarAboutusPage" class="nav-link" href="index.html?page=aboutus">About Us</a>
        </li> 
 
        <li class="nav-item">
          <a id="navbarContactPage" class="nav-link" href="index.html?page=contact">Contact</a>
        </li>  
      </ul>
        <div style="display:inline-block; width: 10px "></div>
      <form class="d-flex">
        <input id="searchbox" class="form-control me-2" type="search" placeholder="Search" aria-label="Search">
        <button id="searchboxSubmit" class="btn btn-outline-success" type="button">Search</button>
        <div style="display:inline-block; width: 10px "></div>
        <button id="searchboxClear" class="btn btn-outline-success" type="button">Clear</button>
      </form>
    </div>
  </div>
</nav> 
  <br/>
      <center><h1 id="pagetitle"></h1></center> 
      <div class="container" style="padding:10px;"> 

         <div class="font-weight-bold" style="float:left; width:30rem; padding:1rem;" id="pageleftpanel"> 
            <p style="color: #212529; font-weight:900; font-size:8rem">Welcome</p>

         </div>
        <div id="mainContainer" style="padding:10px; display: inline-block;"> and other text goes here </div>     
      </div>
      <script> 

function loadNavBar() {
    fetch('./list.json')
        .then(response => response.json())
        .then(data => {
            tagList = []
            data.forEach(row => {
              tagList =tagList.concat(row.tags) 
            }) 
            const tagListTotal = [... new Set(tagList)]  

            tagListTotal.forEach(tagName => {

              const li = document.createElement('li')
              const a = document.createElement('a')
              a.classList.add("dropdown-item")
              a.href = "index.html?tag=" + tagName.replace("/","-")
              a.innerText = tagName
              li.appendChild(a) 
              document.getElementById("navbarDropdownList").appendChild(li) 
            }) 
        })
        .catch(error => {
            console.error('NavBar Error:', error); 
        });

}        
loadNavBar()

function makeTagDiv(tagsArray) {

  const tagsDiv = document.createElement("div")

  tagsArray.forEach((tagelem, elemnum) => {  
      encodedTagelem = encodeURI(tagelem.replace("/", "-"))
      href = "/index.html?tag=" + encodedTagelem

      tagDivAnchor = document.createElement('a')
      tagDivAnchor.href = href  
      tagDivAnchor.class = "tag"  

      tagDivLink = document.createElement('div') 
      tagDivLink.classList.add("tag-dark") 
      tagDivLink.innerText = tagelem

      tagDivAnchor.appendChild(tagDivLink) 
      tagsDiv.appendChild(tagDivAnchor)   
  });

  return tagsDiv; 
}

function makeWikiAndGoogleLinks(row) {
  googleMap = document.createElement('a')
  googleMap.style = "text-decoration: none;"

  if (row['coordinates'].length == 2) {
      googleMap.href = "https://www.google.com/maps/place/" + row['coordinates'][0] + ',' + row['coordinates'][1]
      googleMap.setAttribute('class', 'blank-target-links, card-link')
      googleMap.innerText = 'Google Map'
      googleMap.setAttribute("target", "_blank")
  }

  wikipediaLink = document.createElement("a")
  wikipediaLink.href = row['wikipedia']
  wikipediaLink.setAttribute('class', 'blank-target-links card-link')
  wikipediaLink.innerText = 'Wikipedia'
  wikipediaLink.style = "text-decoration: none;"

  spacer = document.createElement('div')
  spacer.style = "width:10px;display:inline-block"

  returnDiv = document.createElement('div')
  returnDiv.appendChild(wikipediaLink)
  returnDiv.appendChild(spacer)
  returnDiv.appendChild(googleMap)

  return returnDiv
}


function loadDataIntoBody(tagParam, searchParam) {
    const mainContainer = document.getElementById('mainContainer');


    if (tagParam) {   
      document.getElementById("pagetitle").innerText = "Tag: " + tagParam.replace("-","/")
    }
    else if (searchParam) {   
      document.getElementById("pagetitle").innerText = "Search Results for: " + searchParam.replace("-","/")
    }
    else 
      document.getElementById("pagetitle").innerText = "All Results Displayed" 
    fetch('./list.json')
        .then(response => response.json())
        .then(data => {

            console.log("tagParam",tagParam) 
            console.log("searchParam",searchParam) 
            if (tagParam) {    
              const foundResult = data.filter(element => {
                tagParam = tagParam.replace("-","/")
                return element.tags.includes(tagParam)
              }); 
              data = foundResult 
            }

            else if (searchParam) {    
              const foundResultTag = data.filter(element => {
                searchParam = searchParam.replace("-","/")
                return element.tags.includes(searchParam)
              });

              const foundResultSearch = data.filter(element => {
                searchParam = searchParam.toLowerCase() 
                return element['Summary'].toLowerCase().includes(searchParam)
              }); 
              Array.prototype.push.apply(foundResultTag,foundResultSearch);  
              data = foundResultTag 
            }


            count = 0
            rowDivCount = 0
            rowDiv = []   

            const modRowConstant = 4; 

            data.forEach(row => {
 
                if (count % modRowConstant == 0) {  
                    rowDiv[rowDivCount] = document.createElement('div')
                    rowDiv[rowDivCount].classList.add("row") 
                    rowDivCount++;
                }

                var card = document.createElement('div');
                card.setAttribute("class", "card bg-opacity-25") 
                card.style = "max-width:30rem;"

                const hTitle = document.createElement('h5')
                hTitle.innerText = row.Name + ", " + row.Location
                hTitle.classList.add("card-header")
                //hTitle.classList.add("bg-light")
                hTitle.style = "color: rgba(255,255,255,.77);"

                searchText = row.Name + ' ' + row.Location
                searchText = searchText.replace(' ', '+')
  
                const tagsDiv = makeTagDiv(row['tags'])
                tagsDiv.id = "tagsDiv" + count

                firstSentence = row['Summary'].split(/(?<=[.?!]\s)(?=[A-Z])/)[0]
                pSummary = document.createElement('p')
                pSummary.innerText = firstSentence
                pSummary.setAttribute("class", "card-text")
                //pSummary.classList.add("bg-light") 
                pSummary.setAttribute("style", "overflow:auto; height: 150px; color: rgba(255,255,255,.77);")
 
                wikiAndGoogleMap =  makeWikiAndGoogleLinks(row)

                imgAnchor = document.createElement('a')
                imgAnchor.href = "/index.html?details=" + encodeURIComponent(row['Name'])
                imgSrc = document.createElement('img')
                imgSrc.setAttribute("class", "card-img-top")
                imgSrc.style = "max-height:200px; min-height:180px"
                imgSrc.src = row.Image
                imgAnchor.appendChild(imgSrc)

                card.appendChild(hTitle)
                card.appendChild(imgAnchor)

                cardBody = document.createElement('div')
                cardBody.setAttribute("class", "card-body")

                cardBody.appendChild(pSummary)

                pTags = document.createElement('div')
                pTags.setAttribute("class", "card-text")
                pTags.appendChild(tagsDiv)

                cardBody.appendChild(pTags)
                cardBody.appendChild(document.createElement('br'))  
                cardBody.appendChild(wikiAndGoogleMap)  

                card.appendChild(cardBody)


                cardRowBuffer = document.createElement('div')
                cardRowBuffer.setAttribute("class", "col-sm")
                
                cardRowBuffer.appendChild(card) 

                rowDiv[rowDivCount-1].appendChild(cardRowBuffer);

                row.number = count;

                if (count % modRowConstant == 0 || data.length == count-1) {
                    mainContainer.appendChild(rowDiv[rowDivCount-1])
                    mainContainer.appendChild(document.createElement('br'))
                } 
                count++;
            }); 
 
        })
        .catch(error => {
            console.error('Error:', error);
            mainContainer.innerHTML = 'An error occurred while processing data.';
        });
} 

function loadDetailsIntoBody(queryParam) { 
  console.log("loadDetailsIntoBody", loadDetailsIntoBody)


  document.getElementById("mainContainer").innerHTML = '\
      <div style="overflow:hidden;  padding:10px;">\
          <div class="" style="float:left; width:30rem; background-color:#212529; color: rgba(255, 255, 255, .77); padding:1rem; border-radius:10px" id="pageleftpanel" > \
              <div style="height:2rem"></div>\
              <h3 class=" " id="pagelefttitle">Travel Data Builder</h3>  \
              <p id="pagedescription" style="height:60vh; overflow:auto"></p> \
          </div> \
  \
          <div class="" style="display:inline-block; width:2rem; border-radius:20px" > </div>\
          <div class="" style="display:inline-block; border-radius:15px" > \
          <img id="pageinnerimage" style="width: 85rem; overflow:hidden; border-radius:20px"> \
      </div>\
  '


  fetch('./list.json')
    .then(response => response.json())
    .then(data => {

        function findByName(row) { 
          return row['Name'] == queryParam || row['Name'] == decodeURI(queryParam);
        }

        row = data.find(element => element['Name'] == queryParam || element['Name'] == decodeURI(queryParam)); 
        console.log(row); 

        document.getElementById('pagelefttitle').innerText = row["Name"] + ", " + row["Location"]

        document.getElementById('pageinnerimage').src = row["Image"]

        document.getElementById('pagedescription').innerText = row["Summary"]


        const tagDiv = makeTagDiv(row['tags'])
        pageleftpanel.appendChild(tagDiv)
        pageleftpanel.appendChild(document.createElement('br'))


        wikiAndGoogleMap =  makeWikiAndGoogleLinks(row)

        pageleftpanel = document.getElementById("pageleftpanel") 
        pageleftpanel.appendChild(wikiAndGoogleMap)
 
 
      }); 

}

function concatPage() {


}

function aboutusPage() { 

}

function homePage() { 

}


const searchbox = document.getElementById('searchbox');
const searchboxSubmit = document.getElementById('searchboxSubmit');


function searchboxSubmitFunction() { 
  console.log("search sumbmit", searchbox.value)
  loadDataIntoBody(null, searchbox.value);
  console.log(searchbox.value)
  window.location.href = "/index.html?search=" + encodeURI(searchbox.value)
}

searchbox.addEventListener('keydown', (event) => {
    if (event.key === 'Enter') {
        event.preventDefault() 
        console.log("Enter pressed in serachbox")
        searchboxSubmitFunction()
    }
});
searchboxSubmit.addEventListener('click', (event) => { 
        searchboxSubmitFunction() 
});
 
searchboxClear.addEventListener('click', (event) => {
  searchboxSubmit.value = "" 
  window.location.href = "/index.html"
});

function getQueryParameter(queryParamName) {
    const urlParams = new URLSearchParams(window.location.search);
    return urlParams.get(queryParamName);
} 

const tagsParam = getQueryParameter('tag'); 
const searchParam = getQueryParameter('search'); 
const detailsParam = getQueryParameter('details');   
const pageParam = getQueryParameter('page'); 

if (detailsParam)
  loadDetailsIntoBody(detailsParam)

else if (searchParam)
  loadDataIntoBody(null,searchParam)

else if (tagsParam)  
  loadDataIntoBody(tagsParam)
 
else if (pageParam == "contact")
  contactPage() 

else if (pageParam == "aboutus")
  aboutusPage() 

else if (pageParam == "home")
  homePage() 


else loadDataIntoBody()


      </script>
 
   </body>
</html>
