<!doctype html>
<html lang="en">
   <head>
      <meta charset="UTF-8">
      <title>Gloomy Pengiun's Travel Data</title> 
<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-EVSTQN3/azprG1Anm3QDgpJLIm9Nao0Yz1ztcQTwFspd3yD65VohhpuuCOmLASjC" crossorigin="anonymous">
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/js/bootstrap.bundle.min.js" integrity="sha384-MrcW6ZMFYlzcLA8Nl+NtUVF0sA7MsXsP1UyJoMp4YLEuNSfAP+JcXn/tWtIaxVXM" crossorigin="anonymous"></script>

      <link rel="stylesheet" href="travel-data.css">

      <link rel="apple-touch-icon" sizes="180x180" href="/favicon/apple-touch-icon.png">
      <link rel="icon" type="image/png" sizes="32x32" href="/favicon/favicon-32x32.png">
      <link rel="icon" type="image/png" sizes="16x16" href="/favicon/favicon-16x16.png">
      <link rel="manifest" href="/site.webmanifest">
   </head>
   <body>
 

<nav class="navbar navbar-expand-lg navbar-light bg-light">
  <div class="container-fluid">
    <a class="navbar-brand" href="#">Gloomy Penguin's Travel Data in Vanilla JS & Boostrap 5</a>
    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarSupportedContent" aria-controls="navbarSupportedContent" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>
    <div class="collapse navbar-collapse" id="navbarSupportedContent">
      <ul class="navbar-nav me-auto mb-2 mb-lg-0">
        <li class="nav-item">
          <a id="navbarHomePage" class="nav-link active" aria-current="page" href="index.html?page=home">Home</a>
        </li> 

        <li class="nav-item dropdown">
          <a class="nav-link dropdown-toggle" href="#" id="navbarDropdown" role="button" data-bs-toggle="dropdown" aria-expanded="false">
            Destination Tags
          </a>
          <ul class="dropdown-menu" aria-labelledby="navbarDropdown" id="navbarDropdownList"> 
          </ul>
        </li>

        <li class="nav-item">
          <a id="navbarAboutusPage" class="nav-link" href="index.html?page=aboutus">About Us</a>
        </li> 


        <li class="nav-item">
          <a id="navbarContactPage" class="nav-link" href="index.html?page=contact">Contact</a>
        </li> 

      </ul>
      <form class="d-flex">
        <input id="searchbox" class="form-control me-2" type="search" placeholder="Search" aria-label="Search">
        <button id="searchboxSubmit" class="btn btn-outline-success" type="button">Search</button>
        <div style="display:inline-block; width: 10px "></div>
        <button id="searchboxClear" class="btn btn-outline-success" type="button">Clear</button>
      </form>
    </div>
  </div>
</nav>

 

      <center><h3 id="pagetitle"></h3></center> 

      <div id="mainContainer"></div>    
      <script> 

function loadNavBar() {
    fetch('./list.json')
        .then(response => response.json())
        .then(data => {
            tagList = []
            data.forEach(row => {
              tagList =tagList.concat(row.tags) 
            }) 
            const tagListTotal = [... new Set(tagList)]  

            tagListTotal.forEach(tagName => {

              const li = document.createElement('li')
              const a = document.createElement('a')
              a.classList.add("dropdown-item")
              a.href = "index.html?tag=" + tagName.replace("/","-")
              a.innerText = tagName
              li.appendChild(a) 
              document.getElementById("navbarDropdownList").appendChild(li) 
            }) 
        })
        .catch(error => {
            console.error('NavBar Error:', error); 
        });

}        
loadNavBar()

function loadDataIntoBody(tagParam, searchParam) {
    const mainContainer = document.getElementById('mainContainer');


    if (tagParam) {   
      document.getElementById("pagetitle").innerText = tagParam.replace("-","/")
    }
    else if (searchParam) {   
      document.getElementById("pagetitle").innerText = searchParam.replace("-","/")
    }
    else 
      document.getElementById("pagetitle").innerText = "All Results Displayed"
document.getElementById("pagetitle").innerHTML = document.getElementById("pagetitle").innerHTML + "<br/><br/>"
    fetch('./list.json')
        .then(response => response.json())
        .then(data => {

            console.log("tagParam",tagParam) 
            console.log("searchParam",searchParam) 
            if (tagParam) {    
              const foundResult = data.filter(element => {
                tagParam = tagParam.replace("-","/")
                return element.tags.includes(tagParam)
              });
              console.log(foundResult) 
              data = foundResult 
            }

            else if (searchParam) {    
              const foundResultTag = data.filter(element => {
                searchParam = searchParam.replace("-","/")
                return element.tags.includes(searchParam)
              });

              const foundResultSearch = data.filter(element => {
                searchParam = searchParam.toLowerCase() 
                return element['Summary'].toLowerCase().includes(searchParam)
              }); 
              Array.prototype.push.apply(foundResultTag,foundResultSearch); 

              console.log(foundResultTag) 
              data = foundResultTag 
            }


            count = 0
            rowDivCount = 0
            rowDiv = [] 


            console.log(data.length)

            data.forEach(row => {
 
                if (count % 5 == 0) {  
                    rowDiv[rowDivCount] = document.createElement('div')
                    rowDiv[rowDivCount].classList.add("row") 
                    rowDivCount++;
                }

                var card = document.createElement('div');
                card.setAttribute("class", "card")
                card.style = "max-width:30rem; "

                const hTitle = document.createElement('h5')
                hTitle.innerText = row.Name + ", " + row.Location
                hTitle.classList.add("card-header")

                searchText = row.Name + ' ' + row.Location
                searchText = searchText.replace(' ', '+')

                const tagsDiv = document.createElement("div")
                tagsDiv.id = "tagsDiv" + count

                row['tags'].forEach((tagelem, elemnum) => { 
                    if (row.tags.includes(tagelem)) { 
                      encodedTagelem = encodeURI(tagelem.replace("/", "-"))
                      href = "/index.html?tag=" + encodedTagelem

                      tagDivAnchor = document.createElement('a')
                      tagDivAnchor.href = href 
                      tagDivAnchor.style = "display:inline-block;  text-decoration:none; color: black; padding: 1px;padding-left: 2px;padding-right: 2px;border-radius: 15px;"
                      tagDivAnchor.class = "tag"
 

                      tagDivLink = document.createElement('div')
                      tagDivLink.style = "white-space: nowrap;  padding: 1px;padding-left: 2px;padding-right: 2px;border-radius: 15px;background-color: #f2f4f5;"
                      tagDivLink.classList.add("tag")
                      tagDivLink.classList.add("link-secondary")
                      tagDivLink.innerText = tagelem

                      tagDivAnchor.appendChild(tagDivLink) 
                      tagsDiv.appendChild(tagDivAnchor) 

                    }
                });

                firstSentence = row['Summary'].split(/(?<=[.?!]\s)(?=[A-Z])/)[0]
                pSummary = document.createElement('p')
                pSummary.innerText = firstSentence
                pSummary.setAttribute("class", "card-text")
                pSummary.setAttribute("style", "overflow:auto; height: 150px")


                googleMap = document.createElement('a')
                if (row['coordinates'].length == 2) {
                    googleMap.href = "https://www.google.com/maps/place/" + row['coordinates'][0] + ',' + row['coordinates'][1]
                    googleMap.setAttribute('class', 'blank-target-links, card-link')
                    googleMap.innerText = 'Google Map'
                    googleMap.setAttribute("target", "_blank")
                }

                wikipediaLink = document.createElement("a")
                wikipediaLink.href = row['wikipedia']
                wikipediaLink.setAttribute('class', 'blank-target-links card-link')
                wikipediaLink.innerText = 'Wikipedia'

                spacer = document.createElement('div')
                spacer.style = "width:10px;display:inline-block"


                imgAnchor = document.createElement('a')
                imgAnchor.href = "/index.html?details=" + encodeURIComponent(row['Name'])
                imgSrc = document.createElement('img')
                imgSrc.setAttribute("class", "card-img-top")
                imgSrc.style = "max-height:200px; min-height:180px"
                imgSrc.src = row.Image
                imgAnchor.appendChild(imgSrc)

                card.appendChild(hTitle)
                card.appendChild(imgAnchor)

                cardBody = document.createElement('div')
                cardBody.setAttribute("class", "card-body")

                cardBody.appendChild(pSummary)

                pTags = document.createElement('div')
                pTags.setAttribute("class", "card-text")
                pTags.appendChild(tagsDiv)

                cardBody.appendChild(pTags)
                cardBody.appendChild(document.createElement('br'))
                cardBody.appendChild(googleMap)
                cardBody.appendChild(spacer)
                cardBody.appendChild(wikipediaLink)

 
                card.appendChild(cardBody)


                cardRowBuffer = document.createElement('div')
                cardRowBuffer.setAttribute("class", "col-sm")
                
                cardRowBuffer.appendChild(card) 

                rowDiv[rowDivCount-1].appendChild(cardRowBuffer);

                row.number = count;

                if (count % 5 == 0) {
                    mainContainer.appendChild(rowDiv[rowDivCount-1])
                    mainContainer.appendChild(document.createElement('br'))
                } 
                count++;
            }); 
 
        })
        .catch(error => {
            console.error('Error:', error);
            mainContainer.innerHTML = 'An error occurred while processing data.';
        });
} 

function loadDetailsIntoBody(queryParam) { 
  console.log("loadDetailsIntoBody", loadDetailsIntoBody)


  document.getElementById("mainContainer").innerHTML = '\
      <div style="overflow:hidden;  padding:10px;">\
          <div class="" style="float:left; width:30rem; " id="pageleftpanel" > \
              <div style="height:4rem"></div>\
              <h3 class=" " id="pagelefttitle">Travel Data Builder</h3>  \
              <p id="pagedescription" style="height:60vh; overflow:auto"></p> \
          </div> \
  \
          <div class="" style="display:inline-block; width:2rem; border-radius:20px" > </div>\
          <div class="" style="display:inline-block;  order-radius:20px" > \
          <img id="pageinnerimage" style="width: 85rem; overflow:hidden; border-radius:20px"> \
      </div>\
  '


  fetch('./list.json')
    .then(response => response.json())
    .then(data => {

        function findByName(row) { 
          return row['Name'] == queryParam || row['Name'] == decodeURI(queryParam);
        }

        row = data.find(element => element['Name'] == queryParam || element['Name'] == decodeURI(queryParam)); 
        console.log(row); 

        document.getElementById('pagelefttitle').innerText = row["Name"] + ", " + row["Location"]

        document.getElementById('pageinnerimage').src = row["Image"]

        document.getElementById('pagedescription').innerText = row["Summary"]


        const tagDiv = document.createElement("div")
        row['tags'].forEach(tagelem => {  
            tagAnchor = document.createElement('a')  
            encodedTagelem = encodeURI(tagelem.replace("/", "-"))
            tagAnchor.setAttribute("href", "/index.html?tag=" + encodedTagelem)
            tagAnchor.setAttribute("title", "show destinations tagged with '"+ tagelem +"'")
            tagAnchor.setAttribute("rel", "tag")
            tagAnchor.setAttribute("class","tag") 
            tagAnchor.innerText = "  " + tagelem

            linkDiv = document.createElement('div')
            linkDiv.setAttribute("class", "tag")
            linkDiv.appendChild(tagAnchor)  

            tagDiv.appendChild(linkDiv);  

            spacer = document.createElement('div')
            spacer.style = "width:10px;display:inline-block" 
            tagDiv.appendChild(spacer)  
        });  
        pageleftpanel.appendChild(tagDiv)
        pageleftpanel.appendChild(document.createElement('br'))


        googleMap = document.createElement('a') 
        if (row['coordinates'].length == 2) { 
            googleMap.href = "https://www.google.com/maps/place/" + row['coordinates'][0] + ',' + row['coordinates'][1]
            googleMap.setAttribute('class','blank-target-links, card-link')
            googleMap.innerText = 'Google Map'
            googleMap.setAttribute("target", "_blank")
        }  

        wikipediaLink = document.createElement("a")
        wikipediaLink.href = row['wikipedia']
        wikipediaLink.setAttribute('class','blank-target-links')
        wikipediaLink.innerText = 'Wikipedia'

        spacer = document.createElement('div')
        spacer.style = "width:10px;display:inline-block"   

        pageleftpanel = document.getElementById("pageleftpanel")
        pageleftpanel.appendChild(wikipediaLink)
        pageleftpanel.appendChild(spacer)
        pageleftpanel.appendChild(googleMap)
 
      }); 

}

function concatPage() {


}

function aboutusPage() { 

}

function homePage() { 

}


const searchbox = document.getElementById('searchbox');
const searchboxSubmit = document.getElementById('searchboxSubmit');


function searchboxSubmitFunction() { 
  console.log("search sumbmit", searchbox.value)
  loadDataIntoBody(null, searchbox.value);
  console.log(searchbox.value)
  window.location.href = "/index.html?search=" + encodeURI(searchbox.value)
}

searchbox.addEventListener('keydown', (event) => {
    if (event.key === 'Enter') {
        event.preventDefault() 
        console.log("Enter pressed in serachbox")
        searchboxSubmitFunction()
    }
});
searchboxSubmit.addEventListener('click', (event) => { 
        searchboxSubmitFunction() 
});
 
searchboxClear.addEventListener('click', (event) => {
  searchboxSubmit.value = "" 
  window.location.href = "/index.html"
});

function getQueryParameter(queryParamName) {
    const urlParams = new URLSearchParams(window.location.search);
    return urlParams.get(queryParamName);
} 

const tagsParam = getQueryParameter('tag'); 
const searchParam = getQueryParameter('search'); 
const detailsParam = getQueryParameter('details');   
const pageParam = getQueryParameter('page'); 

if (detailsParam)
  loadDetailsIntoBody(detailsParam)

else if (searchParam)
  loadDataIntoBody(null,searchParam)

else if (tagsParam)  
  loadDataIntoBody(tagsParam)
 
else if (pageParam == "contact")
  contactPage() 

else if (pageParam == "aboutus")
  aboutusPage() 

else if (pageParam == "home")
  homePage() 


else loadDataIntoBody()


      </script>
 
   </body>
</html>
