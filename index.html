<!DOCTYPE html>
<html lang="en">
   <head>
      <meta charset="UTF-8">
      <title>Travel Data Builder</title> 
      <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" integrity="sha384-QWTKZyjpPEjISv5WaRU9OFeRpok6YctnYmDr5pNlyT2bRjXh0JMhjY6hW+ALEwIH" crossorigin="anonymous">
      <link rel="stylesheet" href="travel-data.css">

      <link rel="apple-touch-icon" sizes="180x180" href="/favicon/apple-touch-icon.png">
      <link rel="icon" type="image/png" sizes="32x32" href="/favicon/favicon-32x32.png">
      <link rel="icon" type="image/png" sizes="16x16" href="/favicon/favicon-16x16.png">
      <link rel="manifest" href="/site.webmanifest">
   </head>
   <body>
      <nav>
         <h1>Travel Data Builder</h1> 
      </nav> 
 
 

      <h3 id="pagetitle"></h3>

      <div id="mainContainer" class=""  ></div>    
      <script> 


function searchCondition(tagParam) {
    const mainContainer = document.getElementById('mainContainer');


    if (tagParam) {   
      document.getElementById("pagetitle").innerText = tagParam.replace("-","/")
    }
    fetch('./list.json')
        .then(response => response.json())
        .then(data => {

            if (tagParam) {   
              console.log(tagParam)
              const foundResult = data.filter(element => {
                tagParam = tagParam.replace("-","/")
                return element.tags.includes(tagParam)
              });
              console.log(foundResult) 
              data = foundResult 
            }

            count = 0
            rowDivCount = 0
            rowDiv = [] 


            data.forEach(row => {
 
                if (count % 5 == 0) {  
                    rowDiv[rowDivCount] = document.createElement('div')
                    rowDiv[rowDivCount].classList.add("row") 
                    rowDivCount++;
                }

                var card = document.createElement('div');
                card.setAttribute("class", "card")
                //card.style = "width:20rem; "

                const hTitle = document.createElement('h5')
                hTitle.innerText = row.Name + ", " + row.Location
                hTitle.classList.add("card-header")

                searchText = row.Name + ' ' + row.Location
                searchText = searchText.replace(' ', '+')

                const tagsDiv = document.createElement("div")
                tagsDiv.id = "tagsDiv" + count

                row['tags'].forEach(tagelem => { 
                    if (row.tags.includes(tagelem)) {
                        tagAnchor = document.createElement('a')
                        encodedTagelem = encodeURI(tagelem.replace("/", "-"))
                        tagAnchor.setAttribute("href", "/index.html?tags=" + encodedTagelem)
                        tagAnchor.setAttribute("title", "show destinations tagged with '" + tagelem + "'")
                        tagAnchor.setAttribute("rel", "tag")
                        tagAnchor.classList.add("tag") 
                        tagAnchor.innerText = "  " + tagelem

                        linkDiv = document.createElement('div') 
                        linkDiv.classList.add("tag") 
                        linkDiv.appendChild(tagAnchor)

                        tagsDiv.appendChild(linkDiv);

                        spacer = document.createElement('div')
                        spacer.style = "width:10px;display:inline-block"
                        tagsDiv.appendChild(spacer)

                    }
                });

                firstSentence = row['Summary'].split(/(?<=[.?!]\s)(?=[A-Z])/)[0]
                pSummary = document.createElement('p')
                pSummary.innerText = firstSentence
                pSummary.setAttribute("class", "card-text")
                pSummary.setAttribute("style", "overflow:auto; height: 150px")


                googleMap = document.createElement('a')
                if (row['coordinates'].length == 2) {
                    googleMap.href = "https://www.google.com/maps/place/" + row['coordinates'][0] + ',' + row['coordinates'][1]
                    googleMap.setAttribute('class', 'blank-target-links, card-link')
                    googleMap.innerText = 'Google Map'
                    googleMap.setAttribute("target", "_blank")
                }

                wikipediaLink = document.createElement("a")
                wikipediaLink.href = row['wikipedia']
                wikipediaLink.setAttribute('class', 'blank-target-links')
                wikipediaLink.innerText = 'Wikipedia'

                spacer = document.createElement('div')
                spacer.style = "width:10px;display:inline-block"


                imgAnchor = document.createElement('a')
                imgAnchor.href = "/details.html?location=" + encodeURIComponent(row['Name'])
                imgSrc = document.createElement('img')
                imgSrc.setAttribute("class", "card-img-top")
                imgSrc.style = "max-height:200px; min-height:180px"
                imgSrc.src = row.Image
                imgAnchor.appendChild(imgSrc)

                card.appendChild(hTitle)
                card.appendChild(imgAnchor)

                cardBody = document.createElement('div')
                cardBody.setAttribute("class", "card-body")

                cardBody.appendChild(pSummary)

                pTags = document.createElement('div')
                pTags.setAttribute("class", "card-text")
                pTags.appendChild(tagsDiv)

                cardBody.appendChild(pTags)
                cardBody.appendChild(document.createElement('br'))
                cardBody.appendChild(googleMap)
                cardBody.appendChild(spacer)
                cardBody.appendChild(wikipediaLink)

 
                card.appendChild(cardBody)


                cardRowBuffer = document.createElement('div')
                cardRowBuffer.setAttribute("class", "col-sm")
                
                cardRowBuffer.appendChild(card) 

                rowDiv[rowDivCount-1].appendChild(cardRowBuffer);

                row.number = count;

                if (count % 5 == 0) {
                    mainContainer.appendChild(rowDiv[rowDivCount-1])
                    mainContainer.appendChild(document.createElement('br'))
                } 
                count++;
            }); 
        })
        .catch(error => {
            console.error('Error:', error);
            mainContainer.innerHTML = 'An error occurred while fetching data.';
        });
} 

// const input = document.getElementById('conditionInput');

// input.addEventListener('keydown', (event) => {
//     if (event.key === 'Enter') {
//         searchCondition();
//     }
// });

function getQueryParameter(queryParamName) {
    const urlParams = new URLSearchParams(window.location.search);
    return urlParams.get(queryParamName);
}

const tagsParam = getQueryParameter('tags');

console.log(tagsParam)

         
searchCondition(tagsParam)


      </script>
      <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js" integrity="sha384-YvpcrYf0tY3lHB60NNkmXc5s9fDVZLESaAA55NDzOxhy9GkcIdslK1eN7N6jIeHz" crossorigin="anonymous"></script>
   </body>
</html>
